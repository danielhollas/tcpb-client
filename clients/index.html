
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Colton Hicks">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>clients.py - tcpb-client</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="cyan">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#clientspy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="tcpb-client" class="md-header__button md-logo" aria-label="tcpb-client" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tcpb-client
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              clients.py
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="cyan"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/mtzgroup/tcpb-client/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="tcpb-client" class="md-nav__button md-logo" aria-label="tcpb-client" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    tcpb-client
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mtzgroup/tcpb-client/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        tcpb-client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          clients.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        clients.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient" class="md-nav__link">
    TCFrontEndClient
  </a>
  
    <nav class="md-nav" aria-label="TCFrontEndClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.check_job_complete" class="md-nav__link">
    check_job_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute" class="md-nav__link">
    compute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_ci_overlap" class="md-nav__link">
    compute_ci_overlap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_coupling" class="md-nav__link">
    compute_coupling()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_energy" class="md-nav__link">
    compute_energy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_forces" class="md-nav__link">
    compute_forces()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_gradient" class="md-nav__link">
    compute_gradient()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_job_sync" class="md-nav__link">
    compute_job_sync()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.delete" class="md-nav__link">
    delete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.disconnect" class="md-nav__link">
    disconnect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.is_available" class="md-nav__link">
    is_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.ls" class="md-nav__link">
    ls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.put" class="md-nav__link">
    put()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.recv_job_async" class="md-nav__link">
    recv_job_async()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.send_job_async" class="md-nav__link">
    send_job_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient" class="md-nav__link">
    TCProtobufClient
  </a>
  
    <nav class="md-nav" aria-label="TCProtobufClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.check_job_complete" class="md-nav__link">
    check_job_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute" class="md-nav__link">
    compute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_ci_overlap" class="md-nav__link">
    compute_ci_overlap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_coupling" class="md-nav__link">
    compute_coupling()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_energy" class="md-nav__link">
    compute_energy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_forces" class="md-nav__link">
    compute_forces()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_gradient" class="md-nav__link">
    compute_gradient()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_job_sync" class="md-nav__link">
    compute_job_sync()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.disconnect" class="md-nav__link">
    disconnect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.is_available" class="md-nav__link">
    is_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.recv_job_async" class="md-nav__link">
    recv_job_async()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.send_job_async" class="md-nav__link">
    send_job_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../keywords/" class="md-nav__link">
        Keywords
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../random_observations/" class="md-nav__link">
        Random Observations
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/basic_energy/" class="md-nav__link">
        Basic Energy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/ci_overlap/" class="md-nav__link">
        CI Overlap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/cisno_casci%20copy/" class="md-nav__link">
        FOMO CASCI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/cisno_casci/" class="md-nav__link">
        CISNO CASCI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/frontend/" class="md-nav__link">
        TCFrontEndClient
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/frontend_guess_reuse/" class="md-nav__link">
        Frontend Guess Reuse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/guess_reuse/" class="md-nav__link">
        Guess Reuse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/sa_casscf/" class="md-nav__link">
        SA CASSCF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/tddft/" class="md-nav__link">
        TDDFT
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient" class="md-nav__link">
    TCFrontEndClient
  </a>
  
    <nav class="md-nav" aria-label="TCFrontEndClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.check_job_complete" class="md-nav__link">
    check_job_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute" class="md-nav__link">
    compute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_ci_overlap" class="md-nav__link">
    compute_ci_overlap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_coupling" class="md-nav__link">
    compute_coupling()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_energy" class="md-nav__link">
    compute_energy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_forces" class="md-nav__link">
    compute_forces()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_gradient" class="md-nav__link">
    compute_gradient()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.compute_job_sync" class="md-nav__link">
    compute_job_sync()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.delete" class="md-nav__link">
    delete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.disconnect" class="md-nav__link">
    disconnect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.is_available" class="md-nav__link">
    is_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.ls" class="md-nav__link">
    ls()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.put" class="md-nav__link">
    put()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.recv_job_async" class="md-nav__link">
    recv_job_async()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCFrontEndClient.send_job_async" class="md-nav__link">
    send_job_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient" class="md-nav__link">
    TCProtobufClient
  </a>
  
    <nav class="md-nav" aria-label="TCProtobufClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient-methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.check_job_complete" class="md-nav__link">
    check_job_complete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute" class="md-nav__link">
    compute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_ci_overlap" class="md-nav__link">
    compute_ci_overlap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_coupling" class="md-nav__link">
    compute_coupling()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_energy" class="md-nav__link">
    compute_energy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_forces" class="md-nav__link">
    compute_forces()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_gradient" class="md-nav__link">
    compute_gradient()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.compute_job_sync" class="md-nav__link">
    compute_job_sync()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.disconnect" class="md-nav__link">
    disconnect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.is_available" class="md-nav__link">
    is_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.recv_job_async" class="md-nav__link">
    recv_job_async()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpb.clients.TCProtobufClient.send_job_async" class="md-nav__link">
    send_job_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/mtzgroup/tcpb-client/edit/develop/docs/clients.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="clientspy">clients.py<a class="headerlink" href="#clientspy" title="Permanent link">🔗</a></h1>


  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient">
        <code>
tcpb.clients.TCFrontEndClient            (<a title="tcpb.clients.TCProtobufClient" href="#tcpb.clients.TCProtobufClient">TCProtobufClient</a>)
        </code>



<a class="headerlink" href="#tcpb.clients.TCFrontEndClient" title="Permanent link">🔗</a></h2>

    <div class="doc doc-contents first">

      <p>Client for interacting with TeraChem FrontEnd.</p>
<p>TeraChemFrontEndClient communicates with a TeraChem Protocol Buffer Server for
QC compute jobs and with a file server to get/put files to the server. A file may
be put to the server e.g., to use as an initial wave function guess, or any output
file retrieved after a computation.</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TCFrontEndClient</span><span class="p">(</span><span class="n">TCProtobufClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Client for interacting with TeraChem FrontEnd.</span>

<span class="sd">    TeraChemFrontEndClient communicates with a TeraChem Protocol Buffer Server for</span>
<span class="sd">    QC compute jobs and with a file server to get/put files to the server. A file may</span>
<span class="sd">    be put to the server e.g., to use as an initial wave function guess, or any output</span>
<span class="sd">    file retrieved after a computation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span>
        <span class="n">frontend_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
        <span class="n">frontend_host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uploads_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploads&quot;</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frontend_host</span> <span class="o">=</span> <span class="n">frontend_host</span> <span class="ow">or</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frontend_port</span> <span class="o">=</span> <span class="n">frontend_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uploads_prefix</span> <span class="o">=</span> <span class="n">uploads_prefix</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">trace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Main method for sending requests to the TCFrontEnd file server&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
                <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frontend_host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frontend_port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;List directories on TeraChem Server</span>

<span class="sd">        Parmeters:</span>
<span class="sd">            path: Optional filepath.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>

        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Retreive file from TeraChem Server</span>

<span class="sd">        Parmameters:</span>
<span class="sd">            path: Full filepath to the file to download. Does not begin with &#39;/&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Bytes of the file. All files (text or binary) returned as bytes. So to</span>
<span class="sd">            write to disk open file in binary mode. e.g.,:</span>
<span class="sd">                with open(&#39;my_output.txt&#39;, &#39;wb&#39;) as f:</span>
<span class="sd">                    f.write(client.get(&#39;path_to_file&#39;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Upload a file to the TeraChem Server</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the uploaded file.</span>
<span class="sd">            NOTE: Full path will vary from filename passed as server will place file</span>
<span class="sd">                into designated uploads directory with uuid in path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span>
            <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uploads_prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># remove intial &#39;/&#39;</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_or_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Delete a directory or file from the TeraChem Server&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frontend_port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path_or_filename</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Top level method for performing computations with QCSchema inputs/outputs</span>

<span class="sd">        This method should be seen as an implementation of the QCEngine</span>
<span class="sd">        ProgramHarness.compute() method.</span>

<span class="sd">        NOTE: Configuration parameters for controlling TCFrontEndClient behavior are</span>
<span class="sd">            found in AtomicInput.extras[&#39;tcfe:keywords&#39;] and include:</span>
<span class="sd">                1. &#39;c0&#39; | &#39;ca0 and cb0&#39;: Binary files to use as an initial guess</span>
<span class="sd">                    wavefunction</span>
<span class="sd">                2. &#39;scratch_messy&#39;: bool If True client will not delete files on server</span>
<span class="sd">                    after a computation</span>
<span class="sd">                3. &#39;uploads_messy&#39;: bool If True client will not delete uploaded c0</span>
<span class="sd">                    file(s) after a computation</span>
<span class="sd">                4. &#39;native_files&#39;: list[str] of filenames that will be downloaded after</span>
<span class="sd">                    a computation</span>

<span class="sd">        Parameters:</span>
<span class="sd">            atomic_input: AtomicInput object specifying the computation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do pre-compute work</span>
        <span class="n">atomic_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_compute_tasks</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>
        <span class="c1"># Send calculation to TCPBS</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>

        <span class="c1"># Do post-compute work</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_compute_tasks</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_pre_compute_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicInput</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Tasks to be performed prior to submitting computation to TeraChem PBS</span>

<span class="sd">        Currently this involves:</span>
<span class="sd">            1. If binary data found in AtomicInput.extras[&#39;tcfe:keywords&#39;][&#39;c0|ca0/cb0&#39;]</span>
<span class="sd">                it is uploaded to the server and the path is set as the `guess` value</span>
<span class="sd">                in AtomicInput.keywords</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tcfe_keywords</span> <span class="o">=</span> <span class="n">atomic_input</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tcfe_keywords</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">_validate_tcfe_keywords</span><span class="p">(</span><span class="n">tcfe_keywords</span><span class="p">)</span>

        <span class="n">ai_dict</span> <span class="o">=</span> <span class="n">atomic_input</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

        <span class="c1"># Upload c0|ca0/cb0 (wavefunction) data if provided</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="s2">&quot;ca0&quot;</span><span class="p">,</span> <span class="s2">&quot;cb0&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tcfe_keywords</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

            <span class="k">if</span> <span class="s2">&quot;c0&quot;</span> <span class="ow">in</span> <span class="n">tcfe_keywords</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;c0&quot;</span><span class="p">,</span> <span class="n">tcfe_keywords</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ca0 and cb0 both exist</span>
                <span class="n">ca0_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;ca0&quot;</span><span class="p">,</span> <span class="n">tcfe_keywords</span><span class="p">[</span><span class="s2">&quot;ca0&quot;</span><span class="p">])</span>
                <span class="n">cb0_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;cb0&quot;</span><span class="p">,</span> <span class="n">tcfe_keywords</span><span class="p">[</span><span class="s2">&quot;cb0&quot;</span><span class="p">])</span>
                <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ca0_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cb0_path</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># TC wants two, space separated paths</span>

            <span class="c1"># &#39;keywords&#39; will exist because AtomicInput defaults it to {} if empty</span>
            <span class="n">ai_dict</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">][</span><span class="s2">&quot;guess&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">return</span> <span class="n">AtomicInput</span><span class="p">(</span><span class="o">**</span><span class="n">ai_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_post_compute_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">AtomicResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Tasks to be performed after receiving a result from Terachem PBS</span>

<span class="sd">        Currently this involves:</span>
<span class="sd">            1. Getting tc.out if stdout was requested via stdout = True</span>
<span class="sd">            2. Returning c0/ca0/cb0 files if requested via native_files = &#39;all&#39;</span>
<span class="sd">            3. Deleting the files on the server unless scratch_messy = True</span>
<span class="sd">            4. Deleting uploaded files on the server unless uploads_messy = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tcfe_keywords</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tcfe_keywords</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">job_dir</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">extras</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">extras_job_kwarg</span><span class="p">][</span><span class="s2">&quot;job_dir&quot;</span><span class="p">]</span>

        <span class="c1"># dict for modifying attributes</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

        <span class="c1"># Retreive tc.out if requested</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">result_dict</span><span class="p">[</span><span class="s2">&quot;stdout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_dir</span><span class="si">}</span><span class="s2">/tc.out&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="c1"># Retrieve native_files if requested (files produced by TeraChem that don&#39;t fit</span>
        <span class="c1"># cleanly into the QCSchema json)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">native_files</span> <span class="ow">in</span> <span class="p">{</span><span class="n">NativeFilesProtocolEnum</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collect_files</span><span class="p">(</span><span class="n">result_dict</span><span class="p">)</span>

        <span class="c1"># Cleanup uploads</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uploads_prefix</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;guess&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tcfe_keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uploads_messy&quot;</span><span class="p">):</span>
            <span class="c1"># Files were uploaded and put in &quot;guess&quot; keyword; also no request to maintain files</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;guess&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Cleanup Scratch Directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tcfe_keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scratch_messy&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_dir</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AtomicResult</span><span class="p">(</span><span class="o">**</span><span class="n">result_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_collect_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Collects requested native_files.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            result_dict: Dictionary representation of an AtomicResult</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: Modified result dictionary in place</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tcfe_config</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="s2">&quot;extras&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">tcfe_keywords</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">scr_dir</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="s2">&quot;extras&quot;</span><span class="p">][</span><span class="n">settings</span><span class="o">.</span><span class="n">extras_job_kwarg</span><span class="p">][</span><span class="s2">&quot;job_scr_dir&quot;</span><span class="p">]</span>

        <span class="c1"># Assume no native_files added previously</span>
        <span class="n">result_dict</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">tcfe_config_native_files</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">requested_files</span> <span class="o">=</span> <span class="n">tcfe_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;native_files&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">requested_files</span><span class="p">:</span>
            <span class="c1"># Specific files not requested, return all</span>
            <span class="n">requested_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">file_desc</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">file_desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">scr_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_desc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">requested_files</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scr_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="c1"># File is binary</span>
                <span class="k">pass</span>
            <span class="n">result_dict</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">tcfe_config_native_files</span><span class="p">][</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







<h3 id="tcpb.clients.TCFrontEndClient-methods">Methods<a class="headerlink" href="#tcpb.clients.TCFrontEndClient-methods" title="Permanent link">🔗</a></h3>

  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span> <span class="n">frontend_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">frontend_host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uploads_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;uploads&#39;</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.__init__" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span>
    <span class="n">frontend_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
    <span class="n">frontend_host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">uploads_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploads&quot;</span><span class="p">,</span>
    <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frontend_host</span> <span class="o">=</span> <span class="n">frontend_host</span> <span class="ow">or</span> <span class="n">host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frontend_port</span> <span class="o">=</span> <span class="n">frontend_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uploads_prefix</span> <span class="o">=</span> <span class="n">uploads_prefix</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">trace</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.check_job_complete">
<code class="highlight language-python"><span class="n">check_job_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.check_job_complete" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Pack and send a Status message to the TeraChem Protobuf server asynchronously.
This function expects a Status message back with either working or completed set.
Errors out if just busy message returned, implying the job we are checking was not submitted
or had some other issue</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if job is completed, False otherwise</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_job_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pack and send a Status message to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects a Status message back with either working or completed set.</span>
<span class="sd">    Errors out if just busy message returned, implying the job we are checking was not submitted</span>
<span class="sd">    or had some other issue</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if job is completed, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking jobs status...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume check_job_complete is True&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Send Status</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Receive Status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid or no job status received, either no job submitted before check_job_complete() or major server issue&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute">
<code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span></code>


<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Top level method for performing computations with QCSchema inputs/outputs</p>
<p>This method should be seen as an implementation of the QCEngine
ProgramHarness.compute() method.</p>
<div class="admonition note">
<p class="admonition-title">Configuration parameters for controlling TCFrontEndClient behavior are</p>
<p>found in AtomicInput.extras['tcfe:keywords'] and include:
    1. 'c0' | 'ca0 and cb0': Binary files to use as an initial guess
        wavefunction
    2. 'scratch_messy': bool If True client will not delete files on server
        after a computation
    3. 'uploads_messy': bool If True client will not delete uploaded c0
        file(s) after a computation
    4. 'native_files': list[str] of filenames that will be downloaded after
        a computation</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>atomic_input</code></td>
        <td><code>AtomicInput</code></td>
        <td><p>AtomicInput object specifying the computation</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Top level method for performing computations with QCSchema inputs/outputs</span>

<span class="sd">    This method should be seen as an implementation of the QCEngine</span>
<span class="sd">    ProgramHarness.compute() method.</span>

<span class="sd">    NOTE: Configuration parameters for controlling TCFrontEndClient behavior are</span>
<span class="sd">        found in AtomicInput.extras[&#39;tcfe:keywords&#39;] and include:</span>
<span class="sd">            1. &#39;c0&#39; | &#39;ca0 and cb0&#39;: Binary files to use as an initial guess</span>
<span class="sd">                wavefunction</span>
<span class="sd">            2. &#39;scratch_messy&#39;: bool If True client will not delete files on server</span>
<span class="sd">                after a computation</span>
<span class="sd">            3. &#39;uploads_messy&#39;: bool If True client will not delete uploaded c0</span>
<span class="sd">                file(s) after a computation</span>
<span class="sd">            4. &#39;native_files&#39;: list[str] of filenames that will be downloaded after</span>
<span class="sd">                a computation</span>

<span class="sd">    Parameters:</span>
<span class="sd">        atomic_input: AtomicInput object specifying the computation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Do pre-compute work</span>
    <span class="n">atomic_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_compute_tasks</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>
    <span class="c1"># Send calculation to TCPBS</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>

    <span class="c1"># Do post-compute work</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_compute_tasks</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_ci_overlap">
<code class="highlight language-python"><span class="n">compute_ci_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">geom2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvec1file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvec2file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb1afile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb1bfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb2afile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb2bfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_ci_overlap" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute wavefunction overlap given two different geometries, CI vectors, and orbitals,
using the same atom labels/charge/spin multiplicity as the previous calculation.</p>
<p>To run a closed shell calculation, only populate orb1afile/orb2afile, leaving orb1bfile/orb2bfile blank.
Currently, open-shell overlap calculations are not supported by TeraChem.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the first point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>geom2</code></td>
        <td></td>
        <td><p>Cartesian geometry of the second point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cvec1file</code></td>
        <td></td>
        <td><p>Binary file of CI vector for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cvec2file</code></td>
        <td></td>
        <td><p>Binary file of CI vector for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb1afile</code></td>
        <td></td>
        <td><p>Binary file of alpha MO coefficients for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb1bfile</code></td>
        <td></td>
        <td><p>Binary file of beta MO coefficients for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb2afile</code></td>
        <td></td>
        <td><p>Binary file of alpha MO coefficients for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb2bfile</code></td>
        <td></td>
        <td><p>Binary file of beta MO coefficients for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(num_states, num_states) ndarray</code></td>
      <td><p>CI vector overlaps</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_ci_overlap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">geom2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cvec1file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cvec2file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb1afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb1bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb2afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb2bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute wavefunction overlap given two different geometries, CI vectors, and orbitals,</span>
<span class="sd">    using the same atom labels/charge/spin multiplicity as the previous calculation.</span>

<span class="sd">    To run a closed shell calculation, only populate orb1afile/orb2afile, leaving orb1bfile/orb2bfile blank.</span>
<span class="sd">    Currently, open-shell overlap calculations are not supported by TeraChem.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the first point</span>
<span class="sd">        geom2:      Cartesian geometry of the second point</span>
<span class="sd">        cvec1file:  Binary file of CI vector for first geometry (row-major, double64)</span>
<span class="sd">        cvec2file:  Binary file of CI vector for second geometry (row-major, double64)</span>
<span class="sd">        orb1afile:  Binary file of alpha MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">        orb1bfile:  Binary file of beta MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">        orb2afile:  Binary file of alpha MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">        orb2bfile:  Binary file of beta MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        (num_states, num_states) ndarray: CI vector overlaps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">geom2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two geometries to compute_ci_overlap()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cvec1file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cvec2file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two CI vectors to compute_ci_overlap()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">orb1afile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
            <span class="s2">&quot;Did not provide two sets of orbitals to compute_ci_overlap()&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
            <span class="s2">&quot;Did not provide two sets of open-shell orbitals to compute_ci_overlap()&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;WARNING: System specified as closed, but open-shell orbitals were passed to compute_ci_overlap(). Ignoring beta orbitals.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span>
            <span class="s2">&quot;ci_vec_overlap&quot;</span><span class="p">,</span>
            <span class="n">geom</span><span class="p">,</span>
            <span class="n">unitType</span><span class="p">,</span>
            <span class="n">geom2</span><span class="o">=</span><span class="n">geom2</span><span class="p">,</span>
            <span class="n">cvec1file</span><span class="o">=</span><span class="n">cvec1file</span><span class="p">,</span>
            <span class="n">cvec2file</span><span class="o">=</span><span class="n">cvec2file</span><span class="p">,</span>
            <span class="n">orb1afile</span><span class="o">=</span><span class="n">orb1afile</span><span class="p">,</span>
            <span class="n">orb2afile</span><span class="o">=</span><span class="n">orb2afile</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;WARNING: Open-shell systems are currently not supported for overlaps&quot;</span>
        <span class="p">)</span>
        <span class="c1"># results = self.compute_job_sync(&quot;ci_vec_overlap&quot;, geom, unitType, geom2=geom2,</span>
        <span class="c1">#    cvec1file=cvec1file, cvec2file=cvec2file,</span>
        <span class="c1">#    orb1afile=orb1afile, orb1bfile=orb1bfile,</span>
        <span class="c1">#    orb2afile=orb1bfile, orb2bfile=orb2bfile, **kwargs)</span>

    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_coupling">
<code class="highlight language-python"><span class="n">compute_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_coupling" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute nonadiabatic coupling of a new geometry, but with the same atoms labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(num_atoms, 3) ndarray</code></td>
      <td><p>Nonadiabatic coupling vector</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute nonadiabatic coupling of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        (num_atoms, 3) ndarray: Nonadiabatic coupling vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;coupling&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_energy">
<code class="highlight language-python"><span class="n">compute_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_energy" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute energy of a new geometry, but with the same atom labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>Energy</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute energy of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Energy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_forces">
<code class="highlight language-python"><span class="n">compute_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_forces" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute forces of a new geometry, but with the same atoms labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>Tuple of (energy, forces), which is really (energy, -gradient)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute forces of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Tuple of (energy, forces), which is really (energy, -gradient)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_gradient">
<code class="highlight language-python"><span class="n">compute_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_gradient" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute gradient of a new geometry, but with the same atom labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>Tuple of (energy, gradient)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute gradient of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Tuple of (energy, gradient)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.compute_job_sync">
<code class="highlight language-python"><span class="n">compute_job_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.compute_job_sync" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Wrapper for send_job_async() and recv_job_async(), using check_job_complete() to poll the server.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>jobType</code></td>
        <td></td>
        <td><p>Job type key, as defined in the pb.JobInput.RunType enum (defaults to 'energy')</p></td>
        <td><code>&#39;energy&#39;</code></td>
      </tr>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Results mirroring recv_job_async</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_job_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for send_job_async() and recv_job_async(), using check_job_complete() to poll the server.</span>

<span class="sd">    Args:</span>
<span class="sd">        jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &#39;energy&#39;)</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Results mirroring recv_job_async</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;in debug mode - assume compute_job_sync completed successfully&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">accepted</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">completed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_job_async</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.connect">
<code class="highlight language-python"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.connect" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Connect to the TeraChem Protobuf server</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to the TeraChem Protobuf server&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume connection established&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># Timeout of 1 minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem connecting to server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.delete">
<code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_or_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>


<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.delete" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Delete a directory or file from the TeraChem Server</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_or_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Delete a directory or file from the TeraChem Server&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">frontend_port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path_or_filename</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">req</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.disconnect">
<code class="highlight language-python"><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.disconnect" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Disconnect from the TeraChem Protobuf server</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Disconnect from the TeraChem Protobuf server&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume disconnection worked&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Shutdown read and write</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Problem communicating with server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">. Disconnect assumed to have happened&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.get">
<code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span></code>


<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.get" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Retreive file from TeraChem Server</p>
<div class="admonition parmameters">
<p class="admonition-title">Parmameters</p>
<p>path: Full filepath to the file to download. Does not begin with '/'.</p>
</div>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Bytes of the file. All files (text or binary) returned as bytes. So to
write to disk open file in binary mode. e.g.,</code></td>
      <td><p>with open('my_output.txt', 'wb') as f:
        f.write(client.get('path_to_file'))</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Retreive file from TeraChem Server</span>

<span class="sd">    Parmameters:</span>
<span class="sd">        path: Full filepath to the file to download. Does not begin with &#39;/&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Bytes of the file. All files (text or binary) returned as bytes. So to</span>
<span class="sd">        write to disk open file in binary mode. e.g.,:</span>
<span class="sd">            with open(&#39;my_output.txt&#39;, &#39;wb&#39;) as f:</span>
<span class="sd">                f.write(client.get(&#39;path_to_file&#39;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.is_available">
<code class="highlight language-python"><span class="n">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.is_available" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Asks the TeraChem Protobuf server whether it is available or busy through the Status protobuf message.
Note that this does not reserve the server, and the status could change after this function is called.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the TeraChem PB server is currently available (no running job)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Asks the TeraChem Protobuf server whether it is available or busy through the Status protobuf message.</span>
<span class="sd">    Note that this does not reserve the server, and the status could change after this function is called.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the TeraChem PB server is currently available (no running job)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume terachem server is available&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Send Status message</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Receive Status header</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">busy</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.ls">
<code class="highlight language-python"><span class="n">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span></code>


<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.ls" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>List directories on TeraChem Server</p>
<div class="admonition parmeters">
<p class="admonition-title">Parmeters</p>
<p>path: Optional filepath.</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;List directories on TeraChem Server</span>

<span class="sd">    Parmeters:</span>
<span class="sd">        path: Optional filepath.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>

    <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.put">
<code class="highlight language-python"><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>


<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.put" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Upload a file to the TeraChem Server</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Path to the uploaded file.
NOTE</code></td>
      <td><p>Full path will vary from filename passed as server will place file
    into designated uploads directory with uuid in path.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Upload a file to the TeraChem Server</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path to the uploaded file.</span>
<span class="sd">        NOTE: Full path will vary from filename passed as server will place file</span>
<span class="sd">            into designated uploads directory with uuid in path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
    <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span>
        <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uploads_prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># remove intial &#39;/&#39;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.recv_job_async">
<code class="highlight language-python"><span class="n">recv_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.recv_job_async" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Recv and unpack a JobOutput message from the TeraChem Protobuf server asynchronously.
This function expects the job to be ready (i.e. check_job_complete() returned true),
so will error out on timeout.</p>
<p>Creates a results dictionary that mirrors the JobOutput message, using NumPy arrays when appropriate.
Results are also saved in the prev_results class member.
An inclusive list of the results members (with types):</p>
<ul>
<li>atoms:              Flat # of atoms NumPy array of 2-character strings</li>
<li>geom:               # of atoms by 3 NumPy array of doubles</li>
<li>energy:             Either empty, single energy, or flat # of cas_energy_labels of NumPy array of doubles</li>
<li>charges:            Flat # of atoms NumPy array of doubles</li>
<li>spins:              Flat # of atoms NumPy array of doubles</li>
<li>dipole_moment:      Single element (units Debye)</li>
<li>dipole_vector:      Flat 3-element NumPy array of doubles (units Debye)</li>
<li>job_dir:            String</li>
<li>job_scr_dir:        String</li>
<li>server_job_id:      Int</li>
<li>orbfile:            String (if restricted is True, otherwise not included)</li>
<li>orbfile_a:          String (if restricted is False, otherwise not included)</li>
<li>orbfile_b:          String (if restricted is False, otherwise not included)</li>
<li>orb_energies:       Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</li>
<li>orb_occupations:    Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</li>
<li>orb_energies_a:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_occupations_a:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_energies_b:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_occupations_b:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
</ul>
<p>Additional (optional) members of results:</p>
<ul>
<li>bond_order:         # of atoms by # of atoms NumPy array of doubles</li>
</ul>
<p>Available per job type:</p>
<ul>
<li>gradient:           # of atoms by 3 NumPy array of doubles (available for 'gradient' job)</li>
<li>nacme:              # of atoms by 3 NumPy array of doubles (available for 'coupling' job)</li>
<li>ci_overlap:         ci_overlap_size by ci_overlap_size NumPy array of doubles (available for 'ci_vec_overlap' job)</li>
</ul>
<p>Available for CAS jobs:</p>
<ul>
<li>cas_energy_labels:  List of tuples of (state, multiplicity) corresponding to the energy list</li>
<li>cas_transition_dipole:  Flat 3-element NumPy array of doubles (available for 'coupling' job)</li>
</ul>
<p>Available for CIS jobs:</p>
<ul>
<li>cis_states:         Number of excited states for reported properties</li>
<li>cis_unrelaxed_dipoles:    # of excited states list of flat 3-element NumPy arrays (default included with 'cis yes', or explicitly with 'cisunrelaxdipole yes', units a.u.)</li>
<li>cis_relaxed_dipoles:      # of excited states list of flat 3-element NumPy arrays (included with 'cisrelaxdipole yes', units a.u.)</li>
<li>cis_transition_dipoles:   # of excited state combinations (N(N-1)/2) list of flat 3-element NumPy arrays (default includeded with 'cis yes', or explicitly with 'cistransdipole yes', units a.u.)
                            Order given lexically (e.g. 0-&gt;1, 0-&gt;2, 1-&gt;2 for 2 states)</li>
</ul>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Results as described above</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">recv_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recv and unpack a JobOutput message from the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects the job to be ready (i.e. check_job_complete() returned true),</span>
<span class="sd">    so will error out on timeout.</span>

<span class="sd">    Creates a results dictionary that mirrors the JobOutput message, using NumPy arrays when appropriate.</span>
<span class="sd">    Results are also saved in the prev_results class member.</span>
<span class="sd">    An inclusive list of the results members (with types):</span>

<span class="sd">    * atoms:              Flat # of atoms NumPy array of 2-character strings</span>
<span class="sd">    * geom:               # of atoms by 3 NumPy array of doubles</span>
<span class="sd">    * energy:             Either empty, single energy, or flat # of cas_energy_labels of NumPy array of doubles</span>
<span class="sd">    * charges:            Flat # of atoms NumPy array of doubles</span>
<span class="sd">    * spins:              Flat # of atoms NumPy array of doubles</span>
<span class="sd">    * dipole_moment:      Single element (units Debye)</span>
<span class="sd">    * dipole_vector:      Flat 3-element NumPy array of doubles (units Debye)</span>
<span class="sd">    * job_dir:            String</span>
<span class="sd">    * job_scr_dir:        String</span>
<span class="sd">    * server_job_id:      Int</span>
<span class="sd">    * orbfile:            String (if restricted is True, otherwise not included)</span>
<span class="sd">    * orbfile_a:          String (if restricted is False, otherwise not included)</span>
<span class="sd">    * orbfile_b:          String (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_energies:       Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">    * orb_occupations:    Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">    * orb_energies_a:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_occupations_a:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_energies_b:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_occupations_b:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>

<span class="sd">    Additional (optional) members of results:</span>

<span class="sd">    * bond_order:         # of atoms by # of atoms NumPy array of doubles</span>

<span class="sd">    Available per job type:</span>

<span class="sd">    * gradient:           # of atoms by 3 NumPy array of doubles (available for &#39;gradient&#39; job)</span>
<span class="sd">    * nacme:              # of atoms by 3 NumPy array of doubles (available for &#39;coupling&#39; job)</span>
<span class="sd">    * ci_overlap:         ci_overlap_size by ci_overlap_size NumPy array of doubles (available for &#39;ci_vec_overlap&#39; job)</span>

<span class="sd">    Available for CAS jobs:</span>

<span class="sd">    * cas_energy_labels:  List of tuples of (state, multiplicity) corresponding to the energy list</span>
<span class="sd">    * cas_transition_dipole:  Flat 3-element NumPy array of doubles (available for &#39;coupling&#39; job)</span>

<span class="sd">    Available for CIS jobs:</span>

<span class="sd">    * cis_states:         Number of excited states for reported properties</span>
<span class="sd">    * cis_unrelaxed_dipoles:    # of excited states list of flat 3-element NumPy arrays (default included with &#39;cis yes&#39;, or explicitly with &#39;cisunrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">    * cis_relaxed_dipoles:      # of excited states list of flat 3-element NumPy arrays (included with &#39;cisrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">    * cis_transition_dipoles:   # of excited state combinations (N(N-1)/2) list of flat 3-element NumPy arrays (default includeded with &#39;cis yes&#39;, or explicitly with &#39;cistransdipole yes&#39;, units a.u.)</span>
<span class="sd">                                Order given lexically (e.g. 0-&gt;1, 0-&gt;2, 1-&gt;2 for 2 states)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Results as described above</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">)</span>

    <span class="c1"># Parse output into normal python dictionary</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S2&quot;</span><span class="p">),</span>
        <span class="s2">&quot;geom&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s2">&quot;charges&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">charges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;spins&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;dipole_moment&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;dipole_vector&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;job_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_dir</span><span class="p">,</span>
        <span class="s2">&quot;job_scr_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_scr_dir</span><span class="p">,</span>
        <span class="s2">&quot;server_job_id&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">server_job_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">closed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1bfile</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_occupations</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_transition_dipole&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_energy_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">cas_energy_mults</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">):</span>
        <span class="n">nAtoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bond_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nAtoms</span><span class="p">,</span> <span class="n">nAtoms</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">):</span>
            <span class="n">uDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                <span class="n">uDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_unrelaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uDips</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">):</span>
            <span class="n">rDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                <span class="n">rDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_relaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rDips</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">):</span>
            <span class="n">tDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">tDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_transition_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tDips</span>

    <span class="c1"># Save results for user access later</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prev_results</span> <span class="o">=</span> <span class="n">results</span>

    <span class="c1"># Wipe state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCFrontEndClient.send_job_async">
<code class="highlight language-python"><span class="n">send_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCFrontEndClient.send_job_async" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Pack and send the current JobInput to the TeraChem Protobuf server asynchronously.
This function expects a Status message back that either tells us whether the job was accepted.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>jobType</code></td>
        <td></td>
        <td><p>Job type key, as defined in the pb.JobInput.RunType enum (defaults to "energy")</p></td>
        <td><code>&#39;energy&#39;</code></td>
      </tr>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to "bohr")</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True on job acceptance, False on server busy, and errors out if communication fails</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pack and send the current JobInput to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects a Status message back that either tells us whether the job was accepted.</span>

<span class="sd">    Args:</span>
<span class="sd">        jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &quot;energy&quot;)</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &quot;bohr&quot;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True on job acceptance, False on server busy, and errors out if communication fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">jobType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Job type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Allowed run types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide geometry to send_job_async()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">unitType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Unit type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Allowed unit types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume job completed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Job setup</span>
    <span class="n">job_input_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_job_input_msg</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>

    <span class="n">status_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;accepted&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_status</span><span class="p">(</span><span class="n">status_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="tcpb.clients.TCProtobufClient">
        <code>
tcpb.clients.TCProtobufClient        </code>



<a class="headerlink" href="#tcpb.clients.TCProtobufClient" title="Permanent link">🔗</a></h2>

    <div class="doc doc-contents first">

      <p>Connect and communicate with a TeraChem instance running in Protocol Buffer server mode
(i.e. TeraChem was started with the -s|--server flag)</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TCProtobufClient</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Connect and communicate with a TeraChem instance running in Protocol Buffer server mode</span>
<span class="sd">    (i.e. TeraChem was started with the -s|--server flag)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a TCProtobufClient object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            host: Hostname</span>
<span class="sd">            port: Port number (must be above 1023)</span>
<span class="sd">            debug: If True, assumes connections work (used for testing with no server)</span>
<span class="sd">            trace: If True, packets are saved to .bin files (which can then be used for testing)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">port</span> <span class="o">&lt;</span> <span class="mi">1023</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Port number is not allowed to below 1023 (system reserved ports)&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intracefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client_recv.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outtracefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client_sent.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Would like to not hard code this, but the truth is I am expecting exactly 8 bytes, not whatever Python thinks 2 ints is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prev_results</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allow automatic context management using &#39;with&#39; statement</span>

<span class="sd">        &gt;&gt;&gt; with TCProtobufClient(host, port, **options) as TC:</span>
<span class="sd">        &gt;&gt;&gt;     E = TC.compute_energy(geom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect in automatic context management.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect to the TeraChem Protobuf server&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume connection established&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># Timeout of 1 minute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem connecting to server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnect from the TeraChem Protobuf server&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume disconnection worked&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Shutdown read and write</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Problem communicating with server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">. Disconnect assumed to have happened&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Asks the TeraChem Protobuf server whether it is available or busy through the Status protobuf message.</span>
<span class="sd">        Note that this does not reserve the server, and the status could change after this function is called.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the TeraChem PB server is currently available (no running job)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume terachem server is available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Send Status message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Receive Status header</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">busy</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Top level method for performing computations with QCSchema inputs/outputs&quot;&quot;&quot;</span>
        <span class="c1"># Create protobuf message</span>
        <span class="n">job_input_msg</span> <span class="o">=</span> <span class="n">atomic_input_to_job_input</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>
        <span class="c1"># Send message to server; retry until accepted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JobInput not accepted. Retrying...&quot;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">():</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">job_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_output_to_atomic_result</span><span class="p">(</span>
            <span class="n">atomic_input</span><span class="o">=</span><span class="n">atomic_input</span><span class="p">,</span> <span class="n">job_output</span><span class="o">=</span><span class="n">job_output</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pack and send the current JobInput to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">        This function expects a Status message back that either tells us whether the job was accepted.</span>

<span class="sd">        Args:</span>
<span class="sd">            jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &quot;energy&quot;)</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &quot;bohr&quot;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True on job acceptance, False on server busy, and errors out if communication fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">jobType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Job type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Allowed run types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide geometry to send_job_async()&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unitType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unit type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Allowed unit types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume job completed&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Job setup</span>
        <span class="n">job_input_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_job_input_msg</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>

        <span class="n">status_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;accepted&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_status</span><span class="p">(</span><span class="n">status_msg</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_msg</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">Status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets status on self if job is accepted&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The status returned from the TCPB Server is off by one. The status &quot;</span>
            <span class="s2">&quot;returned contains actually contains values for the previous job.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span> <span class="o">=</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">job_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span> <span class="o">=</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">job_scr_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span> <span class="o">=</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">server_job_id</span>

    <span class="k">def</span> <span class="nf">_create_job_input_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method for setting up jobs according to old mechanism</span>

<span class="sd">        Refactored this method out to allow for better testing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_input_msg</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="p">()</span>
        <span class="n">job_input_msg</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="n">jobType</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">job_input_msg</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
        <span class="n">job_input_msg</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="n">unitType</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_kwargs</span><span class="p">(</span><span class="n">job_input_msg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_input_msg</span>

    <span class="k">def</span> <span class="nf">check_job_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pack and send a Status message to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">        This function expects a Status message back with either working or completed set.</span>
<span class="sd">        Errors out if just busy message returned, implying the job we are checking was not submitted</span>
<span class="sd">        or had some other issue</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if job is completed, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking jobs status...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume check_job_complete is True&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Send Status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Receive Status</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid or no job status received, either no job submitted before check_job_complete() or major server issue&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">recv_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recv and unpack a JobOutput message from the TeraChem Protobuf server asynchronously.</span>
<span class="sd">        This function expects the job to be ready (i.e. check_job_complete() returned true),</span>
<span class="sd">        so will error out on timeout.</span>

<span class="sd">        Creates a results dictionary that mirrors the JobOutput message, using NumPy arrays when appropriate.</span>
<span class="sd">        Results are also saved in the prev_results class member.</span>
<span class="sd">        An inclusive list of the results members (with types):</span>

<span class="sd">        * atoms:              Flat # of atoms NumPy array of 2-character strings</span>
<span class="sd">        * geom:               # of atoms by 3 NumPy array of doubles</span>
<span class="sd">        * energy:             Either empty, single energy, or flat # of cas_energy_labels of NumPy array of doubles</span>
<span class="sd">        * charges:            Flat # of atoms NumPy array of doubles</span>
<span class="sd">        * spins:              Flat # of atoms NumPy array of doubles</span>
<span class="sd">        * dipole_moment:      Single element (units Debye)</span>
<span class="sd">        * dipole_vector:      Flat 3-element NumPy array of doubles (units Debye)</span>
<span class="sd">        * job_dir:            String</span>
<span class="sd">        * job_scr_dir:        String</span>
<span class="sd">        * server_job_id:      Int</span>
<span class="sd">        * orbfile:            String (if restricted is True, otherwise not included)</span>
<span class="sd">        * orbfile_a:          String (if restricted is False, otherwise not included)</span>
<span class="sd">        * orbfile_b:          String (if restricted is False, otherwise not included)</span>
<span class="sd">        * orb_energies:       Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">        * orb_occupations:    Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">        * orb_energies_a:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">        * orb_occupations_a:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">        * orb_energies_b:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">        * orb_occupations_b:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>

<span class="sd">        Additional (optional) members of results:</span>

<span class="sd">        * bond_order:         # of atoms by # of atoms NumPy array of doubles</span>

<span class="sd">        Available per job type:</span>

<span class="sd">        * gradient:           # of atoms by 3 NumPy array of doubles (available for &#39;gradient&#39; job)</span>
<span class="sd">        * nacme:              # of atoms by 3 NumPy array of doubles (available for &#39;coupling&#39; job)</span>
<span class="sd">        * ci_overlap:         ci_overlap_size by ci_overlap_size NumPy array of doubles (available for &#39;ci_vec_overlap&#39; job)</span>

<span class="sd">        Available for CAS jobs:</span>

<span class="sd">        * cas_energy_labels:  List of tuples of (state, multiplicity) corresponding to the energy list</span>
<span class="sd">        * cas_transition_dipole:  Flat 3-element NumPy array of doubles (available for &#39;coupling&#39; job)</span>

<span class="sd">        Available for CIS jobs:</span>

<span class="sd">        * cis_states:         Number of excited states for reported properties</span>
<span class="sd">        * cis_unrelaxed_dipoles:    # of excited states list of flat 3-element NumPy arrays (default included with &#39;cis yes&#39;, or explicitly with &#39;cisunrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">        * cis_relaxed_dipoles:      # of excited states list of flat 3-element NumPy arrays (included with &#39;cisrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">        * cis_transition_dipoles:   # of excited state combinations (N(N-1)/2) list of flat 3-element NumPy arrays (default includeded with &#39;cis yes&#39;, or explicitly with &#39;cistransdipole yes&#39;, units a.u.)</span>
<span class="sd">                                    Order given lexically (e.g. 0-&gt;1, 0-&gt;2, 1-&gt;2 for 2 states)</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Results as described above</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">)</span>

        <span class="c1"># Parse output into normal python dictionary</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S2&quot;</span><span class="p">),</span>
            <span class="s2">&quot;geom&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="s2">&quot;charges&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">charges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s2">&quot;spins&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s2">&quot;dipole_moment&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="s2">&quot;dipole_vector&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s2">&quot;job_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_dir</span><span class="p">,</span>
            <span class="s2">&quot;job_scr_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_scr_dir</span><span class="p">,</span>
            <span class="s2">&quot;server_job_id&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">server_job_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">closed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>

            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1bfile</span>

            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_energies</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_occupations</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_transition_dipole&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_energy_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">cas_energy_mults</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">):</span>
            <span class="n">nAtoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bond_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nAtoms</span><span class="p">,</span> <span class="n">nAtoms</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">):</span>
                <span class="n">uDips</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                    <span class="n">uDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_unrelaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uDips</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">):</span>
                <span class="n">rDips</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                    <span class="n">rDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_relaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rDips</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">):</span>
                <span class="n">tDips</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">tDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_transition_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tDips</span>

        <span class="c1"># Save results for user access later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_results</span> <span class="o">=</span> <span class="n">results</span>

        <span class="c1"># Wipe state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">compute_job_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for send_job_async() and recv_job_async(), using check_job_complete() to poll the server.</span>

<span class="sd">        Args:</span>
<span class="sd">            jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &#39;energy&#39;)</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Results mirroring recv_job_async</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;in debug mode - assume compute_job_sync completed successfully&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">accepted</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">completed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_job_async</span><span class="p">()</span>

    <span class="c1"># CONVENIENCE FUNCTIONS #</span>
    <span class="k">def</span> <span class="nf">compute_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute energy of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">        multiplicity and wave function format as the previous calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute gradient of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">        multiplicity and wave function format as the previous calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: Tuple of (energy, gradient)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>

    <span class="c1"># Convenience to maintain compatibility with NanoReactor2</span>
    <span class="k">def</span> <span class="nf">compute_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute forces of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">        multiplicity and wave function format as the previous calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: Tuple of (energy, forces), which is really (energy, -gradient)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute nonadiabatic coupling of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">        multiplicity and wave function format as the previous calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            geom:       Cartesian geometry of the new point</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            (num_atoms, 3) ndarray: Nonadiabatic coupling vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;coupling&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_ci_overlap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">geom2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cvec1file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cvec2file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orb1afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orb1bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orb2afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orb2bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute wavefunction overlap given two different geometries, CI vectors, and orbitals,</span>
<span class="sd">        using the same atom labels/charge/spin multiplicity as the previous calculation.</span>

<span class="sd">        To run a closed shell calculation, only populate orb1afile/orb2afile, leaving orb1bfile/orb2bfile blank.</span>
<span class="sd">        Currently, open-shell overlap calculations are not supported by TeraChem.</span>

<span class="sd">        Args:</span>
<span class="sd">            geom:       Cartesian geometry of the first point</span>
<span class="sd">            geom2:      Cartesian geometry of the second point</span>
<span class="sd">            cvec1file:  Binary file of CI vector for first geometry (row-major, double64)</span>
<span class="sd">            cvec2file:  Binary file of CI vector for second geometry (row-major, double64)</span>
<span class="sd">            orb1afile:  Binary file of alpha MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">            orb1bfile:  Binary file of beta MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">            orb2afile:  Binary file of alpha MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">            orb2bfile:  Binary file of beta MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">            unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">            **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">        Returns:</span>
<span class="sd">            (num_states, num_states) ndarray: CI vector overlaps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">geom2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two geometries to compute_ci_overlap()&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cvec1file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cvec2file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two CI vectors to compute_ci_overlap()&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orb1afile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="s2">&quot;Did not provide two sets of orbitals to compute_ci_overlap()&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="s2">&quot;Did not provide two sets of open-shell orbitals to compute_ci_overlap()&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: System specified as closed, but open-shell orbitals were passed to compute_ci_overlap(). Ignoring beta orbitals.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span>
                <span class="s2">&quot;ci_vec_overlap&quot;</span><span class="p">,</span>
                <span class="n">geom</span><span class="p">,</span>
                <span class="n">unitType</span><span class="p">,</span>
                <span class="n">geom2</span><span class="o">=</span><span class="n">geom2</span><span class="p">,</span>
                <span class="n">cvec1file</span><span class="o">=</span><span class="n">cvec1file</span><span class="p">,</span>
                <span class="n">cvec2file</span><span class="o">=</span><span class="n">cvec2file</span><span class="p">,</span>
                <span class="n">orb1afile</span><span class="o">=</span><span class="n">orb1afile</span><span class="p">,</span>
                <span class="n">orb2afile</span><span class="o">=</span><span class="n">orb2afile</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: Open-shell systems are currently not supported for overlaps&quot;</span>
            <span class="p">)</span>
            <span class="c1"># results = self.compute_job_sync(&quot;ci_vec_overlap&quot;, geom, unitType, geom2=geom2,</span>
            <span class="c1">#    cvec1file=cvec1file, cvec2file=cvec2file,</span>
            <span class="c1">#    orb1afile=orb1afile, orb1bfile=orb1bfile,</span>
            <span class="c1">#    orb2afile=orb1bfile, orb2bfile=orb2bfile, **kwargs)</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span>

    <span class="c1"># Private kwarg helper function</span>
    <span class="k">def</span> <span class="nf">_process_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># noqa NOTE: C901 too complex!</span>
        <span class="sd">&quot;&quot;&quot;Process user-provided keyword arguments into a JobInput object</span>

<span class="sd">        Several keywords are processed by the client to set more complex fields</span>
<span class="sd">        in the Protobuf messages. These are:</span>

<span class="sd">        * geom:               Sets job_options.mol.xyz from a list or NumPy array</span>
<span class="sd">        * geom2:              Sets job_options.xyz2 from a list or NumPy array</span>
<span class="sd">        * bond_order:         Sets job_options.return_bond_order to True or False</span>

<span class="sd">        All others are passed through as key-value pairs to the server, which will</span>
<span class="sd">        place them in the start file.</span>
<span class="sd">        Passing None to a previously set option will remove it from job_options</span>

<span class="sd">        Args:</span>
<span class="sd">            job_options: Target JobInput object</span>
<span class="sd">            **kwargs: Keyword arguments passed by user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate all options are here</span>
        <span class="c1"># TODO: Replace with mtzutils.Options</span>
        <span class="n">required</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;atoms&quot;</span><span class="p">,</span>
            <span class="s2">&quot;charge&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spinmult&quot;</span><span class="p">,</span>
            <span class="s2">&quot;closed_shell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;restricted&quot;</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">,</span>
            <span class="s2">&quot;basis&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Keyword </span><span class="si">%s</span><span class="s2"> must be specified in options&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;atoms&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Each atom must have type: basestring&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">t</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must have type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">MethodType</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Method specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;Allowed methods: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">MethodType</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">t</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must have type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;atoms&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;charge&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;spinmult&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;closed_shell&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;restricted&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">restricted</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">MethodType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;basis&quot;</span><span class="p">:</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;geom&quot;</span><span class="p">:</span>
                <span class="c1"># Standard geometry, usually handled in other calling functions but here just in case</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Geometry provided to geom does not match atom list&quot;</span>
                    <span class="p">)</span>

                <span class="k">del</span> <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:]</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;geom2&quot;</span><span class="p">:</span>
                <span class="c1"># Second geometry for ci_vec_overlap job</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Geometry provided to geom2 does not match atom list&quot;</span>
                    <span class="p">)</span>

                <span class="k">del</span> <span class="n">job_options</span><span class="o">.</span><span class="n">xyz2</span><span class="p">[:]</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">xyz2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;bond_order&quot;</span><span class="p">:</span>
                <span class="c1"># Request Meyer bond order matrix</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bond order request must be True or False&quot;</span><span class="p">)</span>

                <span class="n">job_options</span><span class="o">.</span><span class="n">return_bond_order</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;mo_output&quot;</span><span class="p">:</span>
                <span class="c1"># Request AO and MO information</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">job_options</span><span class="o">.</span><span class="n">imd_orbital_type</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">ImdOrbitalType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span>
                        <span class="s2">&quot;WHOLE_C&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span><span class="p">:</span>
                <span class="c1"># Overwrite currently defined custom user option</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># New custom user option</span>
                <span class="n">job_options</span><span class="o">.</span><span class="n">user_options</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)])</span>

    <span class="c1"># Private send/recv functions</span>
    <span class="k">def</span> <span class="nf">_send_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">msg_pb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a header + PB to the TeraChem Protobuf server (must be connected)</span>

<span class="sd">        Args:</span>
<span class="sd">            msg_type: Message type (defined as enum in protocol buffer)</span>
<span class="sd">            msg_pb: Protocol Buffer to send to the TCPB server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This will always pack integers as 4 bytes since I am requesting a standard packing (big endian)</span>
        <span class="c1"># Big endian is convention for network byte order (because IBM or someone)</span>
        <span class="k">if</span> <span class="n">msg_pb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_size</span> <span class="o">=</span> <span class="n">msg_pb</span><span class="o">.</span><span class="n">ByteSize</span><span class="p">()</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;II&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">msg_size</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Could not send header: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">msg_str</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg_pb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg_str</span> <span class="o">=</span> <span class="n">msg_pb</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Could not send protobuf: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
            <span class="n">packet</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">msg_str</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outtracefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_recv_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">):</span>  <span class="c1"># noqa NOTE: C901 too complex!</span>
        <span class="sd">&quot;&quot;&quot;Receives a header + PB from the TeraChem Protobuf server (must be connected)</span>

<span class="sd">        Args:</span>
<span class="sd">            msg_type: Expected message type (defined as enum in protocol buffer)</span>

<span class="sd">        Returns:</span>
<span class="sd">            protobuf: Protocol Buffer of type msg_type (or None if no PB was sent)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Receive header</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
            <span class="n">nleft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span>
            <span class="k">while</span> <span class="n">nleft</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">nleft</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="n">data</span>
                <span class="n">nleft</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Check we got full message</span>
            <span class="k">if</span> <span class="n">nleft</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                    <span class="s2">&quot;Could not recv header because socket was closed from server&quot;</span><span class="p">,</span> <span class="bp">self</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">nleft</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                    <span class="s2">&quot;Recv&#39;d </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> expected bytes for header&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">nleft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Could not recv header: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">msg_info</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s2">&quot;&gt;II&quot;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">msg_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">msg_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                <span class="s2">&quot;Received header for incorrect packet type (expecting </span><span class="si">{}</span><span class="s2"> and got </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">msg_type</span><span class="p">,</span> <span class="n">msg_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Receive Protocol Buffer (if one was sent)</span>
        <span class="k">if</span> <span class="n">msg_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg_str</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
                <span class="n">nleft</span> <span class="o">=</span> <span class="n">msg_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">while</span> <span class="n">nleft</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">nleft</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">msg_str</span> <span class="o">+=</span> <span class="n">data</span>
                    <span class="n">nleft</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Check we got full message</span>
                <span class="k">if</span> <span class="n">nleft</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                        <span class="s2">&quot;Could not recv message because socket was closed from server&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">nleft</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                        <span class="s2">&quot;Recv&#39;d </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> expected bytes for protobuf&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">nleft</span><span class="p">,</span> <span class="n">msg_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">),</span>
                        <span class="bp">self</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Could not recv protobuf: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">:</span>
            <span class="n">recv_pb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">Status</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">pb</span><span class="o">.</span><span class="n">MOL</span><span class="p">:</span>
            <span class="n">recv_pb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">:</span>
            <span class="n">recv_pb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">:</span>
            <span class="n">recv_pb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">JobOutput</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown message type </span><span class="si">{}</span><span class="s2"> for received message.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_type</span><span class="p">),</span> <span class="bp">self</span>
            <span class="p">)</span>

        <span class="n">recv_pb</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">msg_str</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
            <span class="n">packet</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">msg_str</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intracefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">recv_pb</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







<h3 id="tcpb.clients.TCProtobufClient-methods">Methods<a class="headerlink" href="#tcpb.clients.TCProtobufClient-methods" title="Permanent link">🔗</a></h3>

  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a class="headerlink" href="#tcpb.clients.TCProtobufClient.__init__" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Initialize a TCProtobufClient object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>host</code></td>
        <td><code>str</code></td>
        <td><p>Hostname</p></td>
        <td><code>&#39;127.0.0.1&#39;</code></td>
      </tr>
      <tr>
        <td><code>port</code></td>
        <td><code>int</code></td>
        <td><p>Port number (must be above 1023)</p></td>
        <td><code>11111</code></td>
      </tr>
      <tr>
        <td><code>debug</code></td>
        <td></td>
        <td><p>If True, assumes connections work (used for testing with no server)</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>trace</code></td>
        <td></td>
        <td><p>If True, packets are saved to .bin files (which can then be used for testing)</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11111</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize a TCProtobufClient object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        host: Hostname</span>
<span class="sd">        port: Port number (must be above 1023)</span>
<span class="sd">        debug: If True, assumes connections work (used for testing with no server)</span>
<span class="sd">        trace: If True, packets are saved to .bin files (which can then be used for testing)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">port</span> <span class="o">&lt;</span> <span class="mi">1023</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Port number is not allowed to below 1023 (system reserved ports)&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intracefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client_recv.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outtracefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client_sent.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Would like to not hard code this, but the truth is I am expecting exactly 8 bytes, not whatever Python thinks 2 ints is</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">header_size</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">prev_results</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.check_job_complete">
<code class="highlight language-python"><span class="n">check_job_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.check_job_complete" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Pack and send a Status message to the TeraChem Protobuf server asynchronously.
This function expects a Status message back with either working or completed set.
Errors out if just busy message returned, implying the job we are checking was not submitted
or had some other issue</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if job is completed, False otherwise</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_job_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pack and send a Status message to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects a Status message back with either working or completed set.</span>
<span class="sd">    Errors out if just busy message returned, implying the job we are checking was not submitted</span>
<span class="sd">    or had some other issue</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if job is completed, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking jobs status...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume check_job_complete is True&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Send Status</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Receive Status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">status</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid or no job status received, either no job submitted before check_job_complete() or major server issue&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute">
<code class="highlight language-python"><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Top level method for performing computations with QCSchema inputs/outputs</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomic_input</span><span class="p">:</span> <span class="n">AtomicInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomicResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Top level method for performing computations with QCSchema inputs/outputs&quot;&quot;&quot;</span>
    <span class="c1"># Create protobuf message</span>
    <span class="n">job_input_msg</span> <span class="o">=</span> <span class="n">atomic_input_to_job_input</span><span class="p">(</span><span class="n">atomic_input</span><span class="p">)</span>
    <span class="c1"># Send message to server; retry until accepted</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JobInput not accepted. Retrying...&quot;</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">():</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">job_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">job_output_to_atomic_result</span><span class="p">(</span>
        <span class="n">atomic_input</span><span class="o">=</span><span class="n">atomic_input</span><span class="p">,</span> <span class="n">job_output</span><span class="o">=</span><span class="n">job_output</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_ci_overlap">
<code class="highlight language-python"><span class="n">compute_ci_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">geom2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvec1file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cvec2file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb1afile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb1bfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb2afile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orb2bfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_ci_overlap" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute wavefunction overlap given two different geometries, CI vectors, and orbitals,
using the same atom labels/charge/spin multiplicity as the previous calculation.</p>
<p>To run a closed shell calculation, only populate orb1afile/orb2afile, leaving orb1bfile/orb2bfile blank.
Currently, open-shell overlap calculations are not supported by TeraChem.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the first point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>geom2</code></td>
        <td></td>
        <td><p>Cartesian geometry of the second point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cvec1file</code></td>
        <td></td>
        <td><p>Binary file of CI vector for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cvec2file</code></td>
        <td></td>
        <td><p>Binary file of CI vector for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb1afile</code></td>
        <td></td>
        <td><p>Binary file of alpha MO coefficients for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb1bfile</code></td>
        <td></td>
        <td><p>Binary file of beta MO coefficients for first geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb2afile</code></td>
        <td></td>
        <td><p>Binary file of alpha MO coefficients for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>orb2bfile</code></td>
        <td></td>
        <td><p>Binary file of beta MO coefficients for second geometry (row-major, double64)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(num_states, num_states) ndarray</code></td>
      <td><p>CI vector overlaps</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_ci_overlap</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">geom2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cvec1file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cvec2file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb1afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb1bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb2afile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orb2bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute wavefunction overlap given two different geometries, CI vectors, and orbitals,</span>
<span class="sd">    using the same atom labels/charge/spin multiplicity as the previous calculation.</span>

<span class="sd">    To run a closed shell calculation, only populate orb1afile/orb2afile, leaving orb1bfile/orb2bfile blank.</span>
<span class="sd">    Currently, open-shell overlap calculations are not supported by TeraChem.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the first point</span>
<span class="sd">        geom2:      Cartesian geometry of the second point</span>
<span class="sd">        cvec1file:  Binary file of CI vector for first geometry (row-major, double64)</span>
<span class="sd">        cvec2file:  Binary file of CI vector for second geometry (row-major, double64)</span>
<span class="sd">        orb1afile:  Binary file of alpha MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">        orb1bfile:  Binary file of beta MO coefficients for first geometry (row-major, double64)</span>
<span class="sd">        orb2afile:  Binary file of alpha MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">        orb2bfile:  Binary file of beta MO coefficients for second geometry (row-major, double64)</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        (num_states, num_states) ndarray: CI vector overlaps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">geom2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two geometries to compute_ci_overlap()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cvec1file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cvec2file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide two CI vectors to compute_ci_overlap()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">orb1afile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
            <span class="s2">&quot;Did not provide two sets of orbitals to compute_ci_overlap()&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">orb1bfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
            <span class="s2">&quot;Did not provide two sets of open-shell orbitals to compute_ci_overlap()&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">orb1bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">orb2bfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;WARNING: System specified as closed, but open-shell orbitals were passed to compute_ci_overlap(). Ignoring beta orbitals.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;closed_shell&quot;</span><span class="p">]:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span>
            <span class="s2">&quot;ci_vec_overlap&quot;</span><span class="p">,</span>
            <span class="n">geom</span><span class="p">,</span>
            <span class="n">unitType</span><span class="p">,</span>
            <span class="n">geom2</span><span class="o">=</span><span class="n">geom2</span><span class="p">,</span>
            <span class="n">cvec1file</span><span class="o">=</span><span class="n">cvec1file</span><span class="p">,</span>
            <span class="n">cvec2file</span><span class="o">=</span><span class="n">cvec2file</span><span class="p">,</span>
            <span class="n">orb1afile</span><span class="o">=</span><span class="n">orb1afile</span><span class="p">,</span>
            <span class="n">orb2afile</span><span class="o">=</span><span class="n">orb2afile</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;WARNING: Open-shell systems are currently not supported for overlaps&quot;</span>
        <span class="p">)</span>
        <span class="c1"># results = self.compute_job_sync(&quot;ci_vec_overlap&quot;, geom, unitType, geom2=geom2,</span>
        <span class="c1">#    cvec1file=cvec1file, cvec2file=cvec2file,</span>
        <span class="c1">#    orb1afile=orb1afile, orb1bfile=orb1bfile,</span>
        <span class="c1">#    orb2afile=orb1bfile, orb2bfile=orb2bfile, **kwargs)</span>

    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_coupling">
<code class="highlight language-python"><span class="n">compute_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_coupling" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute nonadiabatic coupling of a new geometry, but with the same atoms labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(num_atoms, 3) ndarray</code></td>
      <td><p>Nonadiabatic coupling vector</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute nonadiabatic coupling of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        (num_atoms, 3) ndarray: Nonadiabatic coupling vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;coupling&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_energy">
<code class="highlight language-python"><span class="n">compute_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_energy" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute energy of a new geometry, but with the same atom labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>Energy</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute energy of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Energy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_forces">
<code class="highlight language-python"><span class="n">compute_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_forces" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute forces of a new geometry, but with the same atoms labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>Tuple of (energy, forces), which is really (energy, -gradient)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute forces of a new geometry, but with the same atoms labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Tuple of (energy, forces), which is really (energy, -gradient)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_gradient">
<code class="highlight language-python"><span class="n">compute_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_gradient" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Compute gradient of a new geometry, but with the same atom labels/charge/spin
multiplicity and wave function format as the previous calculation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>Tuple of (energy, gradient)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute gradient of a new geometry, but with the same atom labels/charge/spin</span>
<span class="sd">    multiplicity and wave function format as the previous calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Tuple of (energy, gradient)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_job_sync</span><span class="p">(</span><span class="s2">&quot;gradient&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.compute_job_sync">
<code class="highlight language-python"><span class="n">compute_job_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.compute_job_sync" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Wrapper for send_job_async() and recv_job_async(), using check_job_complete() to poll the server.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>jobType</code></td>
        <td></td>
        <td><p>Job type key, as defined in the pb.JobInput.RunType enum (defaults to 'energy')</p></td>
        <td><code>&#39;energy&#39;</code></td>
      </tr>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to 'bohr')</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Results mirroring recv_job_async</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_job_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for send_job_async() and recv_job_async(), using check_job_complete() to poll the server.</span>

<span class="sd">    Args:</span>
<span class="sd">        jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &#39;energy&#39;)</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &#39;bohr&#39;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Results mirroring recv_job_async</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;in debug mode - assume compute_job_sync completed successfully&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">accepted</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_job_async</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">completed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_job_complete</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_job_async</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.connect">
<code class="highlight language-python"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.connect" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Connect to the TeraChem Protobuf server</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Connect to the TeraChem Protobuf server&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume connection established&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># Timeout of 1 minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem connecting to server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.disconnect">
<code class="highlight language-python"><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.disconnect" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Disconnect from the TeraChem Protobuf server</p>

        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Disconnect from the TeraChem Protobuf server&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume disconnection worked&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Shutdown read and write</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcsock</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Problem communicating with server: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">. Disconnect assumed to have happened&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.is_available">
<code class="highlight language-python"><span class="n">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.is_available" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Asks the TeraChem Protobuf server whether it is available or busy through the Status protobuf message.
Note that this does not reserve the server, and the status could change after this function is called.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the TeraChem PB server is currently available (no running job)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Asks the TeraChem Protobuf server whether it is available or busy through the Status protobuf message.</span>
<span class="sd">    Note that this does not reserve the server, and the status could change after this function is called.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the TeraChem PB server is currently available (no running job)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume terachem server is available&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Send Status message</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Receive Status header</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="n">status</span><span class="o">.</span><span class="n">busy</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.recv_job_async">
<code class="highlight language-python"><span class="n">recv_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.recv_job_async" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Recv and unpack a JobOutput message from the TeraChem Protobuf server asynchronously.
This function expects the job to be ready (i.e. check_job_complete() returned true),
so will error out on timeout.</p>
<p>Creates a results dictionary that mirrors the JobOutput message, using NumPy arrays when appropriate.
Results are also saved in the prev_results class member.
An inclusive list of the results members (with types):</p>
<ul>
<li>atoms:              Flat # of atoms NumPy array of 2-character strings</li>
<li>geom:               # of atoms by 3 NumPy array of doubles</li>
<li>energy:             Either empty, single energy, or flat # of cas_energy_labels of NumPy array of doubles</li>
<li>charges:            Flat # of atoms NumPy array of doubles</li>
<li>spins:              Flat # of atoms NumPy array of doubles</li>
<li>dipole_moment:      Single element (units Debye)</li>
<li>dipole_vector:      Flat 3-element NumPy array of doubles (units Debye)</li>
<li>job_dir:            String</li>
<li>job_scr_dir:        String</li>
<li>server_job_id:      Int</li>
<li>orbfile:            String (if restricted is True, otherwise not included)</li>
<li>orbfile_a:          String (if restricted is False, otherwise not included)</li>
<li>orbfile_b:          String (if restricted is False, otherwise not included)</li>
<li>orb_energies:       Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</li>
<li>orb_occupations:    Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</li>
<li>orb_energies_a:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_occupations_a:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_energies_b:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
<li>orb_occupations_b:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</li>
</ul>
<p>Additional (optional) members of results:</p>
<ul>
<li>bond_order:         # of atoms by # of atoms NumPy array of doubles</li>
</ul>
<p>Available per job type:</p>
<ul>
<li>gradient:           # of atoms by 3 NumPy array of doubles (available for 'gradient' job)</li>
<li>nacme:              # of atoms by 3 NumPy array of doubles (available for 'coupling' job)</li>
<li>ci_overlap:         ci_overlap_size by ci_overlap_size NumPy array of doubles (available for 'ci_vec_overlap' job)</li>
</ul>
<p>Available for CAS jobs:</p>
<ul>
<li>cas_energy_labels:  List of tuples of (state, multiplicity) corresponding to the energy list</li>
<li>cas_transition_dipole:  Flat 3-element NumPy array of doubles (available for 'coupling' job)</li>
</ul>
<p>Available for CIS jobs:</p>
<ul>
<li>cis_states:         Number of excited states for reported properties</li>
<li>cis_unrelaxed_dipoles:    # of excited states list of flat 3-element NumPy arrays (default included with 'cis yes', or explicitly with 'cisunrelaxdipole yes', units a.u.)</li>
<li>cis_relaxed_dipoles:      # of excited states list of flat 3-element NumPy arrays (included with 'cisrelaxdipole yes', units a.u.)</li>
<li>cis_transition_dipoles:   # of excited state combinations (N(N-1)/2) list of flat 3-element NumPy arrays (default includeded with 'cis yes', or explicitly with 'cistransdipole yes', units a.u.)
                            Order given lexically (e.g. 0-&gt;1, 0-&gt;2, 1-&gt;2 for 2 states)</li>
</ul>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>Results as described above</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">recv_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recv and unpack a JobOutput message from the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects the job to be ready (i.e. check_job_complete() returned true),</span>
<span class="sd">    so will error out on timeout.</span>

<span class="sd">    Creates a results dictionary that mirrors the JobOutput message, using NumPy arrays when appropriate.</span>
<span class="sd">    Results are also saved in the prev_results class member.</span>
<span class="sd">    An inclusive list of the results members (with types):</span>

<span class="sd">    * atoms:              Flat # of atoms NumPy array of 2-character strings</span>
<span class="sd">    * geom:               # of atoms by 3 NumPy array of doubles</span>
<span class="sd">    * energy:             Either empty, single energy, or flat # of cas_energy_labels of NumPy array of doubles</span>
<span class="sd">    * charges:            Flat # of atoms NumPy array of doubles</span>
<span class="sd">    * spins:              Flat # of atoms NumPy array of doubles</span>
<span class="sd">    * dipole_moment:      Single element (units Debye)</span>
<span class="sd">    * dipole_vector:      Flat 3-element NumPy array of doubles (units Debye)</span>
<span class="sd">    * job_dir:            String</span>
<span class="sd">    * job_scr_dir:        String</span>
<span class="sd">    * server_job_id:      Int</span>
<span class="sd">    * orbfile:            String (if restricted is True, otherwise not included)</span>
<span class="sd">    * orbfile_a:          String (if restricted is False, otherwise not included)</span>
<span class="sd">    * orbfile_b:          String (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_energies:       Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">    * orb_occupations:    Flat # of orbitals NumPy array of doubles (if restricted is True, otherwise not included)</span>
<span class="sd">    * orb_energies_a:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_occupations_a:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_energies_b:     Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>
<span class="sd">    * orb_occupations_b:  Flat # of orbitals NumPy array of doubles (if restricted is False, otherwise not included)</span>

<span class="sd">    Additional (optional) members of results:</span>

<span class="sd">    * bond_order:         # of atoms by # of atoms NumPy array of doubles</span>

<span class="sd">    Available per job type:</span>

<span class="sd">    * gradient:           # of atoms by 3 NumPy array of doubles (available for &#39;gradient&#39; job)</span>
<span class="sd">    * nacme:              # of atoms by 3 NumPy array of doubles (available for &#39;coupling&#39; job)</span>
<span class="sd">    * ci_overlap:         ci_overlap_size by ci_overlap_size NumPy array of doubles (available for &#39;ci_vec_overlap&#39; job)</span>

<span class="sd">    Available for CAS jobs:</span>

<span class="sd">    * cas_energy_labels:  List of tuples of (state, multiplicity) corresponding to the energy list</span>
<span class="sd">    * cas_transition_dipole:  Flat 3-element NumPy array of doubles (available for &#39;coupling&#39; job)</span>

<span class="sd">    Available for CIS jobs:</span>

<span class="sd">    * cis_states:         Number of excited states for reported properties</span>
<span class="sd">    * cis_unrelaxed_dipoles:    # of excited states list of flat 3-element NumPy arrays (default included with &#39;cis yes&#39;, or explicitly with &#39;cisunrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">    * cis_relaxed_dipoles:      # of excited states list of flat 3-element NumPy arrays (included with &#39;cisrelaxdipole yes&#39;, units a.u.)</span>
<span class="sd">    * cis_transition_dipoles:   # of excited state combinations (N(N-1)/2) list of flat 3-element NumPy arrays (default includeded with &#39;cis yes&#39;, or explicitly with &#39;cistransdipole yes&#39;, units a.u.)</span>
<span class="sd">                                Order given lexically (e.g. 0-&gt;1, 0-&gt;2, 1-&gt;2 for 2 states)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Results as described above</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBOUTPUT</span><span class="p">)</span>

    <span class="c1"># Parse output into normal python dictionary</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S2&quot;</span><span class="p">),</span>
        <span class="s2">&quot;geom&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s2">&quot;charges&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">charges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;spins&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">spins</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;dipole_moment&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;dipole_vector&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">dipoles</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
        <span class="s2">&quot;job_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_dir</span><span class="p">,</span>
        <span class="s2">&quot;job_scr_dir&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">job_scr_dir</span><span class="p">,</span>
        <span class="s2">&quot;server_job_id&quot;</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">server_job_id</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">closed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1afile</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orbfile_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">orb1bfile</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orba_occupations</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_energies_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_energies</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;orb_occupations_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">orbb_occupations</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">gradient</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nacme&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nacme</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_transition_dipole&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">cas_transition_dipole</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cas_energy_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cas_energy_states</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">cas_energy_mults</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">):</span>
        <span class="n">nAtoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;bond_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">bond_order</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nAtoms</span><span class="p">,</span> <span class="n">nAtoms</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ci_overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">ci_overlaps</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">ci_overlap_size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">[:</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">):</span>
            <span class="n">uDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                <span class="n">uDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_unrelaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_unrelaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uDips</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">):</span>
            <span class="n">rDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span><span class="p">):</span>
                <span class="n">rDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_relaxed_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_relaxed_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rDips</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">):</span>
            <span class="n">tDips</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">cis_states</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">tDips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">cis_transition_dipoles</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cis_transition_dipoles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tDips</span>

    <span class="c1"># Save results for user access later</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prev_results</span> <span class="o">=</span> <span class="n">results</span>

    <span class="c1"># Wipe state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_scr_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">curr_job_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="tcpb.clients.TCProtobufClient.send_job_async">
<code class="highlight language-python"><span class="n">send_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span> <span class="o">=</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a class="headerlink" href="#tcpb.clients.TCProtobufClient.send_job_async" title="Permanent link">🔗</a></h4>

    <div class="doc doc-contents ">

      <p>Pack and send the current JobInput to the TeraChem Protobuf server asynchronously.
This function expects a Status message back that either tells us whether the job was accepted.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>jobType</code></td>
        <td></td>
        <td><p>Job type key, as defined in the pb.JobInput.RunType enum (defaults to "energy")</p></td>
        <td><code>&#39;energy&#39;</code></td>
      </tr>
      <tr>
        <td><code>geom</code></td>
        <td></td>
        <td><p>Cartesian geometry of the new point</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>unitType</code></td>
        <td></td>
        <td><p>Unit type key, as defined in the pb.Mol.UnitType enum (defaults to "bohr")</p></td>
        <td><code>&#39;bohr&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional TeraChem keywords, check _process_kwargs for behaviour</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True on job acceptance, False on server busy, and errors out if communication fails</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tcpb/clients.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_job_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobType</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unitType</span><span class="o">=</span><span class="s2">&quot;bohr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pack and send the current JobInput to the TeraChem Protobuf server asynchronously.</span>
<span class="sd">    This function expects a Status message back that either tells us whether the job was accepted.</span>

<span class="sd">    Args:</span>
<span class="sd">        jobType:    Job type key, as defined in the pb.JobInput.RunType enum (defaults to &quot;energy&quot;)</span>
<span class="sd">        geom:       Cartesian geometry of the new point</span>
<span class="sd">        unitType:   Unit type key, as defined in the pb.Mol.UnitType enum (defaults to &quot;bohr&quot;)</span>
<span class="sd">        **kwargs:   Additional TeraChem keywords, check _process_kwargs for behaviour</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True on job acceptance, False on server busy, and errors out if communication fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">jobType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Job type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Allowed run types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JobInput</span><span class="o">.</span><span class="n">RunType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">geom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Did not provide geometry to send_job_async()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">unitType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Unit type specified is not available in this version of the TCPB client</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Allowed unit types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">UnitType</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in debug mode - assume job completed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Job setup</span>
    <span class="n">job_input_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_job_input_msg</span><span class="p">(</span><span class="n">jobType</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">unitType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">JOBINPUT</span><span class="p">,</span> <span class="n">job_input_msg</span><span class="p">)</span>

    <span class="n">status_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">STATUS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status_msg</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job_status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;accepted&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_status</span><span class="p">(</span><span class="n">status_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../CONTRIBUTING/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Contributing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contributing
            </div>
          </div>
        </a>
      
      
        
        <a href="../keywords/" class="md-footer__link md-footer__link--next" aria-label="Next: Keywords" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Keywords
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.expand"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>